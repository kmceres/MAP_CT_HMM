"high_2" %in% high ~ "high_2"
)) %>%
group_by(CowID, times) %>% mutate(max = ifelse(prob == max(prob), state, "")) %>% fill(max)
post= bind_rows(p2,p3)
View(p3)
p0_2 = read_posterior("posterior0_df_2.csv", time_data, 2, 0)
p0_2 = read_posterior("posterior0_df_2.csv", time_data, 2, 0)
p1_2 = read_posterior("posterior1_df_2.csv", time_data, 2, 1)
p2 = bind_rows(p0_2, p1_2)
p2 = p2  %>% group_by(CowID, state)  %>%
mutate(high = case_when(
state==0 & last(prob) > 0.75 ~ "high_0",
state== 1 & last(prob) > 0.75 ~ "high_1",
state== 0 & last(prob) < 0.75 ~ "high_1",
state== 1 & last(prob) < 0.75 ~ "high_0"
))
p0_3 = read_posterior("posterior0_df_3.csv", time_data, 3, 0)
p1_3 = read_posterior("posterior1_df_3.csv", time_data, 3, 1)
p2_3 = read_posterior("posterior2_df_3.csv", time_data, 3, 2)
p3 = bind_rows(p0_3, p1_3, p2_3)
p3 = p3  %>% group_by(CowID, state)  %>%
mutate(high = case_when(
state==0 & last(prob) > 0.75 ~ "high_0",
state==1 & last(prob) > 0.75 ~ "high_1",
state==2 & last(prob) > 0.75 ~ "high_2")) %>%
group_by(CowID) %>%
mutate(high = case_when(
"high_0" %in% high ~ "high_0",
"high_1" %in% high ~ "high_1",
"high_2" %in% high ~ "high_2"
))
post= bind_rows(p2,p3)
post = post %>% group_by(CowID,nstates,times) %>% mutate(max = ifelse(prob == max(prob), state, "")) %>% fill(max)
post= bind_rows(p2,p3)
post= bind_rows(p2,p3)
post = post %>% group_by(CowID,nstates,times) %>% mutate(max = ifelse(prob == max(prob), state, "")) %>%
group_by(CowID) %>% fill(max)
post= bind_rows(p2,p3)
post = post %>% group_by(CowID,nstates,times) %>% mutate(max = ifelse(prob == max(prob), state, "")) %>%
group_by(CowID, nstates) %>% fill(max)
View(post)
post= bind_rows(p2,p3)
post = post %>% group_by(CowID,nstates,times) %>% mutate(max = ifelse(prob == max(prob), state, "")) #%>%
post= bind_rows(p2,p3)
post_lite = post %>% distinct(CowID, high, .keep_all = F)
post = post %>% group_by(CowID,nstates,times) %>% mutate(max = ifelse(prob == max(prob), state, "")) #%>%
post= bind_rows(p2,p3)
post= bind_rows(p2,p3)
post = post %>% group_by(CowID,nstates,times) %>% mutate(max = ifelse(prob == max(prob), state, NA)) #%>%
post= bind_rows(p2,p3)
post= bind_rows(p2,p3)
post = post %>% group_by(CowID,nstates,times) %>% mutate(max = ifelse(prob == max(prob), state, NA)) #%>%
post= bind_rows(p2,p3)
post = post %>% group_by(CowID,nstates,times) %>% mutate(max = ifelse(prob == max(prob), state, NA)) #%>%
post= bind_rows(p2,p3)
post= bind_rows(p2,p3)
post = post %>% group_by(CowID,nstates,times) %>% mutate(max = ifelse(prob == max(prob), state, NA)) #%>%
post= bind_rows(p2,p3)
post= bind_rows(p2,p3)
post = post %>% group_by(CowID,nstates,times) %>% mutate(max = ifelse(prob == max(prob), state, -1)) #%>%
post= bind_rows(p2,p3)
post= bind_rows(p2,p3)
post = post %>% group_by(CowID,nstates,times) %>% mutate(max_prob = ifelse(prob == max(prob), state, -1)) #%>%
post= bind_rows(p2,p3)
post= bind_rows(p2,p3)
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, NA)) #%>%
post= bind_rows(p2,p3)
View(post)
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, NA)) #%>%
post= bind_rows(p2,p3)
function (..., .id = NULL)
post= bind_rows(p2,p3)
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, NA)) #%>%
post= bind_rows(p2,p3)
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, NA)) %>%
group_by(CowID) %>% mutate(max_prob = max(max_prob) %in% max_prob)
post= bind_rows(p2,p3)
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, NA)) %>%
group_by(CowID) %>% mutate(max_prob = max(max_prob) )
post= bind_rows(p2,p3)
post= bind_rows(p2,p3)
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, NA)) %>%
group_by(CowID) %>% mutate(ifelse(max_prob = max(max_prob), max_prob, max(max_prob)))
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, NA)) %>%
group_by(CowID) %>% mutate(ifelse(max_prob = max(max_prob), max_prob, max(max_prob)))
post= bind_rows(p2,p3)
post= bind_rows(p2,p3)
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, NA)) %>%
group_by(CowID) %>% mutate(max_prob = ifelse(max_prob == max(max_prob), max_prob, max(max_prob)))
post= bind_rows(p2,p3)
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, NA))
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, NA))
post2 = post %>% group_by(CowID) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), max_prob, max(max_prob)))
post2 = post %>% group_by(CowID) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), max_prob, max(max_prob)))
post2
post2 = post %>% group_by(CowID) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), "t", "o")))
post2 = post %>% group_by(CowID) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), "t", "o"))
post2 = post %>% group_by(CowID) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), "t", "o"))
post2 = post %>% group_by(CowID) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), "t", "o"))
post2
max(post$max_prob)
post= bind_rows(p2,p3)
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, -1))
post2 = post %>% group_by(CowID) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), "t", "o"))
post2
post2 = post %>% group_by(CowID) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), max_prob, max(max_prob)))
post2 = post %>% group_by(CowID) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), max_prob, max(max_prob)))
post2
View(post2)
post2 = post %>% group_by(CowID, nstates) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), max_prob, max(max_prob)))
post = post %>% group_by(CowID, nstates) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), max_prob, max(max_prob)))
post = post %>% group_by(CowID, nstates) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), max_prob, max(max_prob)))
post = post %>% group_by(CowID, nstates) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), max_prob, max(max_prob)))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high))+
facet_grid(vars(state), vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
post= bind_rows(p2,p3)
post= bind_rows(p2,p3)
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, -1))
post = post %>% group_by(CowID, nstates, times) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), max_prob, max(max_prob)))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high))+
facet_grid(vars(state), vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high))+
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
post$max_prob = post$max_prob + runif(1, -.5, .5)
post$max_prob = post$max_prob + runif(1, -.5, .5)
post$max_prob = post$max_prob + runif(1, -.5, .5)
runif(1,-.5,.5)
str(post$max_prob)
post$max_prob = as.numeric(post$max_prob) + runif(1, -.5, .5)
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high))+
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high))+
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
post= bind_rows(p2,p3)
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, -1))
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, -1))
post = post %>% group_by(CowID, nstates, times) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), max_prob, max(max_prob)))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high, position=position_jitter(w=0.02, h=0))+
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high, position=position_jitter(w=0.02, h=0))) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high, position=position_jitter(w=0.02, h=0))) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high, position=position_jitter(w=0.02, h=0))) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high, position=position_jitter(w=0.02, h=0))) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
jitter(post$max_prob)
jitter(post$max_prob)
jitter(as.numeric(post$max_prob))
post$max_prob = jitter(as.numeric(post$max_prob))
post$max_prob = jitter(as.numeric(post$max_prob))
post$max_prob = jitter(as.numeric(post$max_prob))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high, position=position_jitter(w=0.02, h=0))) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high)) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high), position = position_dodge(width=.1)) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
post= bind_rows(p2,p3)
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, -1))
post = post %>% group_by(CowID, nstates, times) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), max_prob, max(max_prob)))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high), position = position_dodge(width=.1)) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high), position = position_dodge(width=.3)) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
ggplot(post)+geom_line(aes(x=times, y = jitter(max_prob), group=CowID, color=high)) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
ggplot(post)+geom_line(aes(x=times, y = jitter(max_prob), group=CowID, color=high)) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
ggplot(post)+geom_line(aes(x=times, y = jitter(max_prob), group=CowID, color=high)) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
post$max_prob = as.numeric(post$max_prob)
post$max_prob = as.numeric(post$max_prob)
ggplot(post)+geom_line(aes(x=times, y = jitter(max_prob), group=CowID, color=high)) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high), position=position_jitter()) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high), position=position_dodge()) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
?position_dodge
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high), position=position_dodge2()) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high), position=position_dodge2(width=1)) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high), position=position=position_dodge(width=0.2, height=.2)) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high), position=position=position_dodge(height=.2)) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
post2 = post %>% group_by(CowID, nstates)%>% mutate(max_prob = jitter(as.numeric(post$max_prob))
post2 = post %>% group_by(CowID, nstates)%>% mutate(max_prob = jitter(as.numeric(post$max_prob)))
post2 = post %>% group_by(CowID, nstates)%>% mutate(max_prob = jitter(as.numeric(post$max_prob)))
post2 = post %>% group_by(CowID, nstates)%>% mutate(max_prob = jitter(as.numeric(post$max_prob)))
post2 = post %>% group_by(CowID, nstates)%>% mutate(max_prob = jitter(as.numeric(post$max_prob)))
post2 = post %>% group_by(CowID, nstates)%>% mutate(max_prob = jitter(as.numeric(max_prob)))
ggplot(post2)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high)) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
post2 = post %>% group_by(CowID, nstates)%>% mutate(max_prob = as.numeric(max_prob)+runif(1, -.1,.1))
post2 = post %>% group_by(CowID, nstates)%>% mutate(max_prob = as.numeric(max_prob)+runif(1, -.1,.1))
post2 = post %>% group_by(CowID, nstates)%>% mutate(max_prob = as.numeric(max_prob)+runif(1, -.1,.1))
ggplot(post2)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high)) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
post2 = post %>% group_by(CowID, nstates)%>% mutate(max_prob = as.numeric(max_prob)+runif(1, -.05,.05))
post = post %>% group_by(CowID, nstates)%>% mutate(max_prob = as.numeric(max_prob)+runif(1, -.05,.05))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high)) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
p0_2 = read_posterior("posterior0_df_2.csv", time_data, 2, 0)
p0_2 = read_posterior("posterior0_df_2.csv", time_data, 2, 0)
p1_2 = read_posterior("posterior1_df_2.csv", time_data, 2, 1)
p2 = bind_rows(p0_2, p1_2)
p2 = p2  %>% group_by(CowID, state)  %>%
mutate(Endstate = case_when(
state==0 & last(prob) > 0.75 ~ "0",
state== 1 & last(prob) > 0.75 ~ "1",
state== 0 & last(prob) < 0.75 ~ "1",
state== 1 & last(prob) < 0.75 ~ "0",
"NA"
))
p2 = p2  %>% group_by(CowID, state)  %>%
mutate(Endstate = case_when(
state==0 & last(prob) > 0.75 ~ "0",
state== 1 & last(prob) > 0.75 ~ "1",
state== 0 & last(prob) < 0.75 ~ "1",
state== 1 & last(prob) < 0.75 ~ "0",
"NA"
))
p0_2 = read_posterior("posterior0_df_2.csv", time_data, 2, 0)
p1_2 = read_posterior("posterior1_df_2.csv", time_data, 2, 1)
p2 = bind_rows(p0_2, p1_2)
p2 = p2  %>% group_by(CowID, state)  %>%
mutate(Endstate = case_when(
state==0 & last(prob) > 0.75 ~ "0",
state== 1 & last(prob) > 0.75 ~ "1",
state== 0 & last(prob) < 0.75 ~ "1",
state== 1 & last(prob) < 0.75 ~ "0"
))
p0_3 = read_posterior("posterior0_df_3.csv", time_data, 3, 0)
p1_3 = read_posterior("posterior1_df_3.csv", time_data, 3, 1)
p2_3 = read_posterior("posterior2_df_3.csv", time_data, 3, 2)
p3 = bind_rows(p0_3, p1_3, p2_3)
p3 = p3  %>% group_by(CowID, state)  %>%
mutate(Endstate = case_when(
state==0 & last(prob) > 0.75 ~ "0",
state==1 & last(prob) > 0.75 ~ "1",
state==2 & last(prob) > 0.75 ~ "2")) %>%
group_by(CowID) %>%
mutate(Endstate = case_when(
"high_0" %in% high ~ "0",
"high_1" %in% high ~ "1",
"high_2" %in% high ~ "2",
"NA"
))
p3 = p3  %>% group_by(CowID, state)  %>%
mutate(Endstate = case_when(
state==0 & last(prob) > 0.75 ~ "0",
state==1 & last(prob) > 0.75 ~ "1",
state==2 & last(prob) > 0.75 ~ "2")) %>%
group_by(CowID) %>%
mutate(Endstate = case_when(
"high_0" %in% high ~ "0",
"high_1" %in% high ~ "1",
"high_2" %in% high ~ "2"
))
post= bind_rows(p2,p3)
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, -1))
post = post %>% group_by(CowID, nstates, times) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), max_prob, max(max_prob)))
post = post %>% group_by(CowID, nstates)%>% mutate(max_prob = as.numeric(max_prob)+runif(1, -.05,.05))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=high)) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=Endstate)) +
facet_grid(vars(nstates))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))+
labs(color = "End State")
p0_2 = read_posterior("posterior0_df_2.csv", time_data, 2, 0)
p0_2 = read_posterior("posterior0_df_2.csv", time_data, 2, 0)
p1_2 = read_posterior("posterior1_df_2.csv", time_data, 2, 1)
p2 = bind_rows(p0_2, p1_2)
p2 = p2  %>% group_by(CowID, state)  %>%
mutate(Endstate = case_when(
state==0 & last(prob) > 0.75 ~ "0",
state== 1 & last(prob) > 0.75 ~ "1",
state== 0 & last(prob) < 0.75 ~ "1",
state== 1 & last(prob) < 0.75 ~ "0"
))
p0_3 = read_posterior("posterior0_df_3.csv", time_data, 3, 0)
p1_3 = read_posterior("posterior1_df_3.csv", time_data, 3, 1)
p2_3 = read_posterior("posterior2_df_3.csv", time_data, 3, 2)
p3 = bind_rows(p0_3, p1_3, p2_3)
p3 = p3  %>% group_by(CowID, state)  %>%
mutate(Endstate = case_when(
state==0 & last(prob) > 0.75 ~ "0",
state==1 & last(prob) > 0.75 ~ "1",
state==2 & last(prob) > 0.75 ~ "2")) %>%
group_by(CowID) %>%
mutate(Endstate = case_when(
"high_0" %in% high ~ "0",
"high_1" %in% high ~ "1",
"high_2" %in% high ~ "2"
))
p3 = p3  %>% group_by(CowID, state)  %>%
mutate(Endstate = case_when(
state==0 & last(prob) > 0.75 ~ "0",
state==1 & last(prob) > 0.75 ~ "1",
state==2 & last(prob) > 0.75 ~ "2")) %>%
group_by(CowID) %>%
mutate(Endstate = case_when(
"0" %in% high ~ "0",
"1" %in% high ~ "1",
"2" %in% high ~ "2"
))
post= bind_rows(p2,p3)
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, -1))
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, -1))
post = post %>% group_by(CowID, nstates, times) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), max_prob, max(max_prob)))
post = post %>% group_by(CowID, nstates)%>% mutate(max_prob = as.numeric(max_prob)+runif(1, -.05,.05)) %>%
mutate(nstates2 = ifelse(nstates == "2"~ "2 State", "3 State"))
post = post %>% group_by(CowID, nstates)%>% mutate(max_prob = as.numeric(max_prob)+runif(1, -.05,.05)) %>%
mutate(nstates2 = ifelse(nstates == 2~ "2 State", "3 State"))
post = post %>% group_by(CowID, nstates)%>% mutate(max_prob = as.numeric(max_prob)+runif(1, -.05,.05)) %>%
mutate(nstates2 = ifelse(nstates == 2~ "2 State", "3 State"))
post = post %>% group_by(CowID, nstates)%>% mutate(max_prob = as.numeric(max_prob)+runif(1, -.05,.05)) %>%
mutate(nstates2 = ifelse(nstates == 2~ "2 State", "3 State"))
post$nstates
post = post %>% group_by(CowID, nstates)%>% mutate(max_prob = as.numeric(max_prob)+runif(1, -.05,.05)) %>%
mutate(nstates2 = ifelse(nstates == "2" , "2 State", "3 State"))
post = post %>% group_by(CowID, nstates)%>% mutate(max_prob = as.numeric(max_prob)+runif(1, -.05,.05)) %>%
mutate(nstates2 = ifelse(nstates == "2" , "2 State", "3 State"))
post = post %>% group_by(CowID, nstates)%>% mutate(max_prob = as.numeric(max_prob)+runif(1, -.05,.05)) %>%
mutate(nstates2 = ifelse(nstates == "2" , "2 State", "3 State"))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=Endstate)) +
facet_grid(vars(nstates2))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))+
labs(color = "End State", y = "Maximum posterior probability")
p0_2 = read_posterior("posterior0_df_2.csv", time_data, 2, 0)
p1_2 = read_posterior("posterior1_df_2.csv", time_data, 2, 1)
p2 = bind_rows(p0_2, p1_2)
p2 = p2  %>% group_by(CowID, state)  %>%
mutate(Endstate = case_when(
state==0 & last(prob) > 0.75 ~ "0",
state== 1 & last(prob) > 0.75 ~ "1",
state== 0 & last(prob) < 0.75 ~ "1",
state== 1 & last(prob) < 0.75 ~ "0"
))
p0_3 = read_posterior("posterior0_df_3.csv", time_data, 3, 0)
p1_3 = read_posterior("posterior1_df_3.csv", time_data, 3, 1)
p2_3 = read_posterior("posterior2_df_3.csv", time_data, 3, 2)
p3 = bind_rows(p0_3, p1_3, p2_3)
p3 = p3  %>% group_by(CowID, state)  %>%
mutate(Endstate = case_when(
state==0 & last(prob) > 0.75 ~ "0",
state==1 & last(prob) > 0.75 ~ "1",
state==2 & last(prob) > 0.75 ~ "2")) %>%
group_by(CowID) %>%
mutate(Endstate = case_when(
"0" %in% high ~ "0",
"1" %in% high ~ "1",
"2" %in% high ~ "2"
))
p0_3 = read_posterior("posterior0_df_3.csv", time_data, 3, 0)
p1_3 = read_posterior("posterior1_df_3.csv", time_data, 3, 1)
p2_3 = read_posterior("posterior2_df_3.csv", time_data, 3, 2)
p3 = bind_rows(p0_3, p1_3, p2_3)
p3 = p3  %>% group_by(CowID, state)  %>%
mutate(Endstate = case_when(
state==0 & last(prob) > 0.75 ~ "0",
state==1 & last(prob) > 0.75 ~ "1",
state==2 & last(prob) > 0.75 ~ "2")) %>%
group_by(CowID) %>%
mutate(Endstate = case_when(
"0" %in% Endstate ~ "0",
"1" %in% Endstate ~ "1",
"2" %in% Endstate ~ "2"
))
post= bind_rows(p2,p3)
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, -1))
post = post %>% group_by(CowID, nstates, times) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), max_prob, max(max_prob)))
post = post %>% group_by(CowID, nstates)%>% mutate(max_prob = as.numeric(max_prob)+runif(1, -.05,.05)) %>%
mutate(nstates2 = ifelse(nstates == "2" , "2 State", "3 State"))
ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=Endstate)) +
facet_grid(vars(nstates2))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))+
labs(color = "End State", y = "Maximum posterior probability")
4/129
4/102
5/102
7/102
8/102
p5 = ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=Endstate)) +
facet_grid(vars(nstates2))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))+
labs(color = "End State", y = "Maximum posterior probability")
post = filter(is.na(max_post) == F)
post = filter(is.na(max_post) == F)
post = filter(is.na(max_post) == F)
post = filter(is.na(max_prob) == F)
post = post %>% filter(is.na(max_prob) == F)
post = post %>% filter(is.na(max_prob) == F)
p5 = ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=Endstate)) +
facet_grid(vars(nstates2))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))+
labs(color = "End State", y = "Maximum posterior probability")
p5
post = post %>% filter(is.na(Endstate) == F)
post = post %>% filter(is.na(Endstate) == F)
post = post %>% filter(is.na(Endstate) == F)
p5 = ggplot(post)+geom_line(aes(x=times, y = max_prob, group=CowID, color=Endstate)) +
facet_grid(vars(nstates2))+ scale_color_manual(values=c("#874E9A","#50AAA3","#BAC438"))+
labs(color = "End State", y = "Maximum posterior probability")
p5
ggsave("Fig4.tiff", p5, dpi = 500, width = 4, height = 5)
ggsave("Fig4.tiff", p5, dpi = 500, width = 4, height = 5)
ggsave("Fig4.tiff", p5, dpi = 500, width = 4, height = 5)
setwd("/Users/kristinaceres/Development/HMM_project/Post_review_1/NewPlots/")
ggsave("Fig4.tiff", p5, dpi = 500, width = 4, height = 5)
ggsave("Fig4.tiff", p5, dpi = 500, width = 5, height = 5)
ggsave("Fig4.tiff", p5, dpi = 500, width = 6, height = 5)
post= bind_rows(p2,p3)
post = post %>% group_by(CowID, nstates, times) %>% mutate(max_prob = ifelse(prob == max(prob), state, -1))
post = post %>% group_by(CowID, nstates, times) %>%
mutate(max_prob = ifelse(max_prob == max(max_prob), max_prob, max(max_prob)))
post = post %>% group_by(CowID, nstates)%>% mutate(max_prob = as.numeric(max_prob)+runif(1, -.05,.05)) %>%
mutate(nstates2 = ifelse(nstates == "2" , "2 State", "3 State"))
data
d = data %>% distinct(CowID.x)
d
nrow(d)
qmat3
1/qmat3
qmat2
1/qmat2
38 weeks 38 weeks 332 weeks
expm(qmat3)
expm(qmat3*200)
exp(-9.742448e-01*10)
exp(-9.742448e-01*1)
exp(-9.742448e-01*2)
exp(-9.742448e-01*3)
exp(-9.742448e-01*4)
exp(-9.742448e-01*5)
## sojourn
s2 = diag(2)%*%qmat2
s2
diag(2)
qmat2
## sojourn
s2 = diag(2) * qmat2
s2
s2
## sojourn
s2 = diag(2) %*%  qmat2
## sojourn
s2 = diag(2) %*%  qmat2
s2
s2
## sojourn
s2 = qmat2 %*% diag(2)
s2
s2
## sojourn
s2 = qmat2 *diag(2)
s2
## sojourn
s2 = exp(-qmat2)
s2
s2
qmat2
exp(-0.026546715)
## sojourn
x = c(1,100)
x
x
## sojourn
x = 1:100
x
2_00 = exp(-qmat[1,1]*x)
two_state_00 = exp(-qmat[1,1]*x)
two_state_00 = exp(-qmat[1,1]*x)
two_state_00 = exp(-qmat[1,1]*x)
two_state_00 = exp(-qmat2[1,1]*x)
two_state_00
1/qmat2[1,1]
exp(-qmat2[1,1])
-1/qmat2[1,1]
plot(x, two_state_00)
two_state_00 = exp(-qmat2[2,2]*x)
plot(x, two_state_00)
two_state_00 = exp(-qmat2[2,2]*x)
plot(x, two_state_00)
## sojourn
-1/qmat2[1,1]
## sojourn
-1/qmat2[1,1]
-1/qmat2[2,2]
-1/qmat2[2,2]
-1/qmat3[1,1]
-1/qmat3[2,2]
-1/qmat2[1,1]
-1/qmat3[1,1]
-1/qmat3[2,2]
